<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Seats Booking</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js" integrity="sha384-fbbOQedDUMZZ5KreZpsbe1LCZPVmfTnH7ois6mU1QK+m14rQ1l2bGBq41eYeM/fS" crossorigin="anonymous"></script>
    <style>
      .seat
      {
        width: 10px;
        height: 5px;
      }
      .row
      {
        margin-left: 150px;
      }
      .legend
      {
        margin-right: 15px;
        margin-right: 15px;
      }
    </style>
  </head>
</head>
<body>
    <header>
        <div class="container mt-5 col-6 d-flex align-items-center justify-content-center">
            <div class="row g-3 align-items-center">
                <div class="col-auto">
                    <label for="inputPassword6" class="col-form-label" style="color: white">Pick a movie:</label>
                </div>
                <div class="dropdown">
                    <a id="movie-name" class="btn btn-secondary dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">Select a Movie</a>
                  
                    <ul id="movie-dropdown" class="dropdown-menu">
                    </ul>
                  </div>
            </div>
        </div>
    </header>

    <main>
      <div class="container mt-5 col-6 d-flex align-items-center justify-content-center" style="color: white">
          <span class="legend">
            <button class="btn btn-secondary btn-square"></button>
            Available
          </span>
          <span class="legend">
            <button class="btn btn-info btn-square"></button>
            Selected
          </span>
          <span class="legend">
            <button class="btn btn-light btn-square"></button>
            Occupied
          </span>
      </div>

      <div id="seats-container" class="container col-5 mt-5 align-items-center justify-content-center" style="color: white">
        <div class="row"></div>
        <div class="row"></div>
        <div class="row"></div>
        <div class="row"></div>
        <div class="row"></div>
        <div class="row"></div>
      </div>
    </main>

    <footer>
      <div class="container mt-5 col-6 d-flex align-items-center justify-content-center" id="selection-details" style="color: white"></div>
      <div class="container mt-5 col-6 d-flex align-items-center justify-content-center">
        <button type="button" class="btn btn-success" onclick="buy()">Buy</button>
      </div>
    </footer>
    

    <script>
        document.body.style = "background-color: black";

        function Movie(name, price)
        {
          this.name = name;
          this.price = price;
        }

        let ToyStory = new Movie("Toy Story", 5);
        let Flash = new Movie("Flash", 8);
        let Oppenheimer = new Movie("Oppenheimer", 10);

        let movies = [];

        movies.push(ToyStory);
        movies.push(Flash);
        movies.push(Oppenheimer);

        let dropdownMenu = document.getElementById('movie-dropdown');

        for (let i = 0; i < movies.length; i++)
        {
          let liTag = document.createElement('li');
          let content = movies[i].name + " ($" + movies[i].price + ")"; 
          liTag.innerHTML = '<a class="dropdown-item" href="#" onclick="updateMovie(this)">' + content + '</a>';
          dropdownMenu.append(liTag);
        }

        let currentMovie;
      
        function updateMovie(currElement)
        {
          let content = currElement.textContent;
          console.log(content);
          var regex = new RegExp(content);
          console.log(regex);
          currentMovie = movies.find(function(movie) {
              return regex.test(movie.name);
          })
          console.log(currentMovie);
          let listItem = currElement.parentNode;
          let parentList = listItem.parentNode;
          let displayNode = parentList.previousElementSibling;
          displayNode.textContent = currElement.textContent;
        }

        let seatsContainer = document.getElementById('seats-container');
        let numRows = seatsContainer.childElementCount;

        for (let i = 1; i <= numRows; i++)
        {
            let currentRow = seatsContainer.querySelectorAll("div:nth-child("+ i +")");
            let seat = document.createElement('button');
            seat.classList.add('btn'); 
            seat.classList.add('btn-secondary');
            seat.classList.add('btn-square');
            seat.classList.add('m-2');
            seat.classList.add('seat');
            seat.setAttribute("onclick", "updatePrice(this)");
            seat.setAttribute('status', 'available');

          for (let j = 0; j < 2; j++)
          {
            const Seat = seat.cloneNode(true);
            currentRow[0].appendChild(Seat);
          }

          for (let j = 0; j < 4; j++)
          {
            const Seat = seat.cloneNode(true);
            currentRow[0].appendChild(Seat);

          }

          for (let j = 0; j < 2; j++)
          {
            const Seat = seat.cloneNode(true);
            currentRow[0].appendChild(Seat);
          }
        }

        let selectedSeats = 0;

        function updatePrice(currentSeat)
        {
          let movieName = document.getElementById('movie-name');
          if (movieName.textContent == "Select a Movie")
          {
            alert("Please select a movie before selecting seats");
          }
          else
          {
            if (currentSeat.getAttribute("status") == "available")
            {
              selectedSeats++;
              currentSeat.setAttribute('status', "unavailable");
              currentSeat.classList.remove('btn-secondary');
              currentSeat.classList.add('btn-info');
              currentSeat.classList.add('selected');
            }
            else
            {
              selectedSeats--;
              currentSeat.setAttribute('status', "available")
              currentSeat.classList.remove('btn-info');
              currentSeat.classList.add('btn-secondary');
              currentSeat.classList.remove('selected');
            }
            let footer = document.getElementById('selection-details');
            footer.textContent = "You have selected " + selectedSeats + " seats";
          }
        }

        function buy()
        {
          console.log('buy called');
          let soldSeats = document.querySelectorAll('.selected');
          for (let i = 0; i < soldSeats.length; i++)
          {
            soldSeats[i].classList.remove('btn-info');
            soldSeats[i].classList.add('btn-light');
          }
          let footer = document.getElementById('selection-details');
          footer.textContent = "";
          selectedSeats = 0;
        }
    </script>
</body>
</html>